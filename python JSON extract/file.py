import requests
import json
import random
from tqdm import tqdm

# Replace 'YOUR_ISBNS' with a list of ISBN values
isbns = [
    9780439785969,
    9780439358071,
    9780439554893,
    9780439655484,
    9780439682589,
    9780976540601,
    9780439827607,
    9780517226957,
    9780345453747,
    9781400052929,
    9780739322208,
    9780517149256,
    9780767908184,
    9780767915069,
    9780767910439,
    9780767903868,
    9780767903820,
    9780060920081,
    9780380713806,
    9780380727506,
    9780380715435,
    9780345538376,
    9780618517657,
    9780618346257,
    9780618260584,
    9780618391004,
    9780618510825,
    9780976694007,
    9780689840920,
    9781557344496,
    9780385326506,
    9781575606248,
    9781595580276,
    9781595962805,
    9780670059676,
    9780141312620,
    9780595321803,
    9781590301944,
    9780449146972,
    9780061159176,
    9780060762735,
    9780060749910,
    9780273704744,
    9781932386103,
    9780374517199,
    9780374280390,
    9780374519742,
    9780374522599,
    9780374518738,
    9780374522872,
    9780374519322,
    9780374516000,
    9780374520656,
    9780822205104,
    9780679734994,
    9781596670235,
    9781581807745,
    9780800793616,
    9780871202864,
    9780753454947,
    9780871209993,
    9781852402877,
    9780761129585,
    9780972016414,
    9781581805635,
    9780441294671,
    9780441102679,
    9780441172696,
    9780765306470,
    9780399128981,
    9780765353702,
    9780441328000,
    9780618212903,
    9780345410054,
    9780385732543,
    9780785260059,
    9780471780939,
    9780325001531,
    9780060762872,
    9780470045299,
    9780072262780,
    9780764569241,
    9780471933823,
    9780764559914,
    9780764584381,
    9780596523695,
    9780806523491,
    9780806525365,
    9780596527310,
    9780143035008,
    9780451528612,
    9780140449174,
    9780822001836,
    9781593080273,
    9780486437965,
    9781593081775,
    9780778322276,
    9780521313254,
    9780140183955,
    9780679767473,
    9781568491981,
    9780743270793,
    9780932863058,
    9780742508804,
    9780205358625,
    9781557344038,
    9780380720446,
    9780821925324,
    9780439271691,
    9780606105262,
    9780751506433,
    9780060786717,
    9780743499347,
    9780765313409,
    9781400032495,
    9781400032488,
    9781400032464,
    9780679732525,
    9780312424442,
    9780806930770,
    9780140366600,
    9780811201124,
    9780802130167,
    9780802131782,
    9780802151827,
    9780802151780,
    9780802151803,
    9780811201063,
    9780141439631,
    9781593080969,
    9781571290533,
    9781565842212,
    9780394743042,
    9781851681822,
    9781566562492,
    9780140195538,
    9780394431246,
    9780806501901,
    9780679439202,
    9780753453803,
    9781402714573,
    9781416500292,
    9780689854682,
    9780517221143,
    9781577658054,
    9780933121188,
    9780785950103,
    9780394800844,
    9780821778258,
    9780060733032,
    9788432216060,
    9780345413994,
    9780441788385,
    9780441748600,
    9780345316509,
    9780765314932,
    9780671742515,
    9780345455291,
    9780345476517,
    9780345368430,
    9781417622856,
    9780573650963,
    9780691122946,
    9780393329407,
    9780671867423,
    9780395883976,
    9780684848150,
    9780140156041,
    9780140119480,
    9780679722946,
    9780743244251,
    9780140179170,
    9780679722953,
    9781594201202,
    9780060930219,
    9780060931674,
    9780140283389,
    9780312423209,
    9780141180632,
    9780143039945,
    9780316724432,
    9780140189308,
    9781400043149,
    9780374522216,
    9780679754862,
    9780679752868,
    9780374521721,
    9780679754855,
    9780307264879,
    9780374529949,
    9780143039839,
    9780140097313,
    9780140097351,
    9780940650763,
    9780963188922,
    9780312426231,
    9780140115857,
    9780140154078,
    9780805081459,
    9780140178135,
    9780811214988,
    9782742741465,
    9780143036555,
    9780446579780,
    9780521386739,
    9780743203043,
    9780345438713,
    9780393318289,
    9781599869940,
    9780806519609,
    9780822549208,
    9780932813862,
    9780373792689,
    9780974514055,
    9780764585975,
    9780307281708,
    9780812969702,
    9780060255084,
    9780330485388,
    9781594130236,
    9780345360359,
    9780321430847,
    9783822840856,
    9780743264464,
    9780743236010,
    9780553572490,
    9780060589462,
    9780802789471,
    9780688060695,
    9781859605158,
    9781592530878,
    9780451528803,
    9780192833983,
    9780486451381,
    9780452011878,
    9780451163080,
    9780452286757,
    9780451163936,
    9780452281257,
    9780451187840,
    9780451147950,
    9780452274044,
    9780471791430,
    9780553803815,
    9780375755194,
    9781592283194,
    9780975599518,
    9780374502003,
    9780307263940,
    9780312405540,
    9780195170139,
    9781400079490,
    9780688171629,
    9780060932688,
    9781400034956,
    9780307350428,
    9780307350442,
    9781400034543,
    9781400095803,
    9780375708114,
    9780861714926,
    9781843535843,
    9781740594776,
    9788408064763,
    9781740592055,
    9780618710539,
    9780060512804,
    9782228894166,
    9780060733353,
    9780060593087,
    9780553383447,
    9780380816033,
    9780553380965,
    9780553383430,
    9780060833183,
    9780553380958,
    9781880685358,
    9781880685334,
    9780465067107,
    9780465051366,
    9780465067091,
    9780898709193,
    9780060887964,
    9780061122415,
    9781421504605,
    9781591169253,
    9781421504599,
    9781591169208,
    9781591169291,
    9780060192501,
    9781591169239,
    9780812974614,
    9781587157394,
    9780142000670,
    9780060554736,
    9780142401200,
    9780808553038,
    9781400096893,
    9780739326220,
    9780099498186,
    9781557046833,
    9780099771517,
    9780743430593,
    9781932664393,
    9780521750844,
    9780802415318,
    9781416524793,
    9788495618771,
    9780972859899,
    9780307277671,
    9780767926034,
    9782266144346,
    9781416524809,
    9780552151764,
    9780593055076,
    9780786016068,
    9780671015206,
    9781585424337,
    9781932429237,
    9780977616657,
    9781563410901,
    9780345479174,
    9780451205360,
    9781419349997,
    9781400098033,
    9780743226721,
    9780140481396,
    9780226014906,
    9781416500186,
    9780310258971,
    9780060838584,
    9780141006871,
    9780812968064,
    9780385340540,
    9780394720241,
    9780345480606,
    9780060193393,
    9781579546014,
    9780972018418,
    9780471743675,
    9780471430452,
    9780805431575,
    9780679838869,
    9780373250714,
    9780140143454,
    9780802732293,
    694055000612,
    9780307238276,
    9781400052585
]


book_data_array = []


def fetch_book_data(isbn):
    url = f'http://openlibrary.org/api/books?bibkeys=ISBN:{isbn}&format=json&jscmd=data'

    try:
        response = requests.get(url)
        data = response.json()

        if f'ISBN:{isbn}' in data:
            book_info = data[f'ISBN:{isbn}']
            
            last_3_characters = random.randint(1, 999)

            image_url = f'https://source.unsplash.com/random/200x200?sig={last_3_characters}'

            # Generate a random 3-digit price
            price = str(round(random.uniform(100, 999), 2))
            authors_list = book_info.get('authors', [{'name': ''}])
            authors = ', '.join(author['name'] for author in authors_list[:2])
            book_data = {
            'title': book_info.get('title', ''),
            'authors': authors,
            'price': price,
            'genre': ' '.join(subject['name'] for subject in book_info.get('subjects', [{'name': book_info.get('title', '')}])),
            'description': book_info.get('excerpts', [{'text': ''}])[0]['text'],
            'language': book_info.get('languages', [{'key': 'English'}])[0]['key'],
            'publicationDate': book_info.get('publish_date', ''),
            'imageUrl': book_info.get('cover', {}).get('medium', image_url),
            }
            book_data_array.append(book_data)
        else:
            print(f'Book not found for ISBN: {isbn}')
    except Exception as e:
        print(f'Error fetching data for ISBN {isbn}: {e}')


def fetch_all_book_data():
    # Create a loading bar with tqdm
    with tqdm(total=len(isbns), desc="Fetching Book Data") as pbar:
        for isbn in isbns:
            fetch_book_data(isbn)
            pbar.update(1)  # Update the loading bar

    # Export the collected book data as JSON
    with open('book_data.json', 'w', encoding='utf-8') as json_file:
        json.dump(book_data_array, json_file, ensure_ascii=False, indent=4)


fetch_all_book_data()
print('Data saved to book_data.json')
